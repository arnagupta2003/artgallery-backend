import{$ as K,Ag as Fe,Be as Ie,C as n,Cb as B,Ce as Se,Cf as ke,D as a,Da as ae,De as Ee,E as d,Ee as Te,F as I,G as S,Ga as oe,Ge as je,Gf as De,Hg as Je,I as W,Ib as ue,Ic as _,J as b,Jf as J,K as f,Kf as M,Le as Be,Lf as A,Mf as O,Oc as ye,Pg as Me,Qe as Pe,R as E,S as s,T as v,U as u,Ua as re,V as L,Vf as we,ba as X,bc as P,bg as Le,c as U,cb as le,dc as ge,ea as o,ec as ve,fa as r,fc as _e,g as V,ga as Z,h as Q,hf as k,ia as T,jg as R,ka as ee,kg as $,ma as te,mg as q,n as i,na as j,nb as pe,oe as xe,og as H,pb as se,q as y,rb as ce,s as x,sb as F,t as Y,ta as N,ua as ie,ub as me,uc as he,vc as fe,w as z,wc as be,x as g,xa as ne,xb as de,xc as Ce,y as w,z as l,zg as Ne}from"./chunk-KEHI5R4L.js";import{a as D}from"./chunk-BAF7YKD7.js";var Oe=(e,p)=>({"is-success":e,"is-danger":p});function Re(e,p){e&1&&(I(0),s(1),o(2,"translate"),S()),e&2&&(i(),u(" ",r(2,1,"system.health-all-systems-up")," "))}function $e(e,p){e&1&&(s(0),o(1,"translate")),e&2&&u(" ",r(1,1,"system.health-error")," ")}function qe(e,p){if(e&1&&(n(0,"div",9)(1,"div",10),d(2,"clr-icon",11),a(),n(3,"div",12),g(4,Re,3,3,"ng-container",13)(5,$e,2,3,"ng-template",null,0,T),n(7,"div",14),s(8),o(9,"translate"),o(10,"async"),o(11,"localeDate"),a()()()),e&2){let t=p.ngIf,c=E(6),m=f();i(2),l("ngClass",X(13,Oe,t==="ok",t!=="ok")),w("shape",t==="ok"?"check-circle":"exclamation-circle"),i(2),l("ngIf",t==="ok")("ngIfElse",c),i(4),L(" ",r(9,6,"system.health-last-checked"),": ",Z(11,10,r(10,8,m.healthCheckService.lastCheck$),"mediumTime")," ")}}function He(e,p){e&1&&(I(0),d(1,"clr-icon",17),s(2),o(3,"translate"),S()),e&2&&(i(2),u(" ",r(3,1,"system.health-status-up")," "))}function Ge(e,p){e&1&&(d(0,"clr-icon",18),s(1),o(2,"translate")),e&2&&(i(),u(" ",r(2,1,"system.health-status-down")," "))}function Ue(e,p){if(e&1&&(n(0,"tr")(1,"td",15),s(2),a(),n(3,"td",15)(4,"vdr-chip",16),g(5,He,4,3,"ng-container",13)(6,Ge,3,3,"ng-template",null,1,T),a()(),n(8,"td",15),s(9),a()()),e&2){let t=p.$implicit,c=E(7);i(2),v(t.key),i(2),l("colorType",t.result.status==="up"?"success":"error"),i(),l("ngIf",t.result.status==="up")("ngIfElse",c),i(4),v(t.result.message)}}function Ve(e,p){if(e&1&&(n(0,"span",3),s(1),o(2,"percent"),a()),e&2){let t=f();i(),u(" ",r(2,1,t.job.progress/100)," ")}}var Qe=()=>["DeleteSettings","DeleteSystem"];function Ye(e,p){e&1&&(I(0),n(1,"vdr-chip"),s(2),o(3,"translate"),a(),S()),e&2&&(i(2),v(r(3,1,"system.all-job-queues")))}function ze(e,p){if(e&1&&(n(0,"vdr-chip",20),s(1),a()),e&2){let t=f().item;l("colorFrom",t.name),i(),v(t.name)}}function We(e,p){if(e&1&&g(0,Ye,4,3,"ng-container",19)(1,ze,2,2,"ng-template",null,0,T),e&2){let t=p.item,c=E(2);l("ngIf",t.name==="all")("ngIfElse",c)}}function Ke(e,p){if(e&1&&s(0),e&2){let t=p.item;u(" ",t.id," ")}}function Xe(e,p){if(e&1&&(s(0),o(1,"timeAgo")),e&2){let t=p.item;u(" ",r(1,1,t.createdAt)," ")}}function Ze(e,p){if(e&1&&(n(0,"vdr-chip",20),s(1),a()),e&2){let t=p.item;l("colorFrom",t.queueName),i(),v(t.queueName)}}function et(e,p){if(e&1&&(n(0,"vdr-dropdown")(1,"button",22),o(2,"translate"),d(3,"clr-icon",23),a(),n(4,"vdr-dropdown-menu")(5,"div",24),d(6,"vdr-object-tree",5),a()()()),e&2){let t=f().item;i(),l("title",r(2,2,"system.job-data")),i(5),l("value",t.data)}}function tt(e,p){if(e&1&&g(0,et,7,4,"vdr-dropdown",21),e&2){let t=p.item;l("ngIf",t.data)}}function it(e,p){if(e&1&&(n(0,"div",27),s(1),a()),e&2){let t=f().item;i(),u("after ",t.attempts," attempts")}}function nt(e,p){if(e&1&&(n(0,"div",27),s(1),a()),e&2){let t=f().item;i(),L(" attempting ",t.attempts," of ",t.retries+1," ")}}function at(e,p){if(e&1&&(d(0,"vdr-job-state-label",25),g(1,it,2,1,"div",26)(2,nt,2,2,"div",26)),e&2){let t=p.item;l("job",t),i(),l("ngIf",t.state==="FAILED"),i(),l("ngIf",t.state==="RUNNING"||t.state==="RETRYING")}}function ot(e,p){if(e&1&&(s(0),o(1,"duration")),e&2){let t=p.item;u(" ",r(1,1,t.duration)," ")}}function rt(e,p){if(e&1&&(n(0,"vdr-dropdown")(1,"button",28),d(2,"clr-icon",23),s(3),o(4,"translate"),a(),n(5,"vdr-dropdown-menu")(6,"div",24),d(7,"vdr-object-tree",5),a()()()),e&2){let t=f().item;i(3),u(" ",r(4,2,"system.job-result")," "),i(4),l("value",t.result)}}function lt(e,p){if(e&1&&(n(0,"vdr-dropdown")(1,"button",29),d(2,"clr-icon",30),s(3),o(4,"translate"),a(),n(5,"vdr-dropdown-menu")(6,"div",24),s(7),a()()()),e&2){let t=f().item;i(3),u(" ",r(4,2,"system.job-error")," "),i(4),u(" ",t.error," ")}}function pt(e,p){if(e&1){let t=W();n(0,"vdr-dropdown")(1,"button",31),d(2,"clr-icon",32),a(),n(3,"vdr-dropdown-menu",33)(4,"button",34),o(5,"hasPermission"),b("click",function(){V(t);let m=f().item,h=f();return Q(h.cancelJob(m.id))}),d(6,"clr-icon",35),s(7),o(8,"translate"),a()()()}e&2&&(i(4),l("disabled",!r(5,2,K(6,Qe))),i(3),u(" ",r(8,4,"common.cancel")," "))}function st(e,p){if(e&1&&g(0,rt,8,4,"vdr-dropdown",21)(1,lt,8,4,"vdr-dropdown",21)(2,pt,9,7,"vdr-dropdown",21),e&2){let t=p.item,c=f();l("ngIf",c.hasResult(t)),i(),l("ngIf",t.error),i(),l("ngIf",!t.isSettled&&t.state!=="FAILED")}}var ct=(()=>{class e{constructor(t){this.healthCheckService=t}static{this.\u0275fac=function(c){return new(c||e)(y(Pe))}}static{this.\u0275cmp=x({type:e,selectors:[["vdr-health-check"]],standalone:!1,decls:30,vars:18,consts:[["error",""],["down",""],["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["shape","check-circle"],["shape","exclamation-circle"]],template:function(c,m){c&1&&(n(0,"vdr-page-header"),d(1,"vdr-page-title"),a(),n(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),g(6,qe,12,16,"div",2),o(7,"async"),a(),n(8,"vdr-ab-right"),d(9,"vdr-action-bar-items",3),n(10,"button",4),b("click",function(){return m.healthCheckService.refresh()}),d(11,"clr-icon",5),s(12),o(13,"translate"),a()()()(),n(14,"vdr-page-block")(15,"table",6)(16,"thead")(17,"tr")(18,"th",7),s(19),o(20,"translate"),a(),n(21,"th",7),s(22),o(23,"translate"),a(),n(24,"th",7),s(25),o(26,"translate"),a()()(),n(27,"tbody"),g(28,Ue,10,5,"tr",8),o(29,"async"),a()()()()),c&2&&(i(6),l("ngIf",r(7,6,m.healthCheckService.status$)),i(6),u(" ",r(13,8,"system.health-refresh")," "),i(7),u(" ",r(20,10,"common.name")," "),i(3),u(" ",r(23,12,"system.health-status")," "),i(3),u(" ",r(26,14,"system.health-message")," "),i(3),l("ngForOf",r(29,16,m.healthCheckService.details$)))},dependencies:[P,ee,te,j,O,M,A,k,J,q,H,$,R,N,F,Be],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-inline-end:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0})}}return e})(),mt=(()=>{class e{get iconShape(){switch(this.job.state){case _.COMPLETED:return"check-circle";case _.FAILED:return"exclamation-circle";case _.CANCELLED:return"ban";case _.PENDING:case _.RETRYING:return"hourglass";case _.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case _.COMPLETED:return"success";case _.FAILED:case _.CANCELLED:return"error";case _.PENDING:case _.RETRYING:return"";case _.RUNNING:return"warning"}}static{this.\u0275fac=function(c){return new(c||e)}}static{this.\u0275cmp=x({type:e,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},standalone:!1,decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(c,m){c&1&&(n(0,"vdr-chip",0),d(1,"clr-icon",1),s(2),o(3,"titlecase"),g(4,Ve,3,3,"span",2),a()),c&2&&(l("colorType",m.colorType),i(),w("shape",m.iconShape),i(),u(" ",r(3,4,m.job.state)," "),i(2),l("ngIf",m.job.state==="RUNNING"))},dependencies:[P,j,k,ne,ie],styles:[".progress[_ngcontent-%COMP%]{margin-inline-start:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0})}}return e})(),dt=(()=>{class e extends Me{constructor(t,c,m){super(c,m),this.dataService=t,this.liveUpdate=new B(!0),this.queueFilter=new B("all"),this.stateFilter=new B(""),super.setQueryFn((...h)=>this.dataService.settings.getAllJobs(...h),h=>h.jobs,(h,C)=>{let Ae=this.queueFilter.value==="all"?null:{queueName:{eq:this.queueFilter.value}},G=this.stateFilter.value;return{options:{skip:h,take:C,filter:D(D({},Ae),G?{state:{eq:G}}:{}),sort:{createdAt:ye.DESC}}}})}ngOnInit(){super.ngOnInit(),ae(5e3,2e3).pipe(le(this.destroy$),re(()=>!!this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(t=>t.jobQueues).pipe(oe(t=>[{name:"all",running:!0},...t]))}hasResult(t){let c=t.result;return c==null?!1:typeof c=="object"?Object.keys(c).length>0:!0}cancelJob(t){this.dataService.settings.cancelJob(t).subscribe(()=>this.refresh())}static{this.\u0275fac=function(c){return new(c||e)(y(xe),y(se),y(pe))}}static{this.\u0275cmp=x({type:e,selectors:[["vdr-job-list"]],standalone:!1,features:[z],decls:67,vars:80,consts:[["others",""],[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["locationId","job-list"],[1,"mr-2",3,"change","addTag","hideSelected","multiple","markFirst","clearable","searchable","formControl"],[3,"value"],["colorType","warning"],["colorType","success"],["colorType","error"],["bindValue","name",3,"change","addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"pageChange","itemsPerPageChange","items","itemsPerPage","totalItems","currentPage"],["id","id",3,"heading"],["id","created-at",3,"heading"],["id","job-queue-name",3,"heading","optional"],["id","job-data",3,"heading","optional"],["id","job-state",3,"heading"],["id","job-duration",3,"heading"],["id","job-result",3,"heading"],[4,"ngIf","ngIfElse"],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"button-small",3,"title"],["shape","details"],[1,"result-detail"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"button-small","mr-1"],["vdrDropdownTrigger","",1,"button-small"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click","disabled"],["shape","ban",1,"is-danger"]],template:function(c,m){c&1&&(n(0,"vdr-page-header"),d(1,"vdr-page-title"),a(),n(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",1),d(7,"input",2),n(8,"label"),s(9),o(10,"translate"),a()()(),n(11,"vdr-ab-right"),d(12,"vdr-action-bar-items",3),n(13,"ng-select",4),b("change",function(){return m.refresh()}),n(14,"ng-option",5)(15,"vdr-chip"),s(16),o(17,"translate"),a()(),n(18,"ng-option",5)(19,"vdr-chip"),s(20),o(21,"translate"),a()(),n(22,"ng-option",5)(23,"vdr-chip",6),s(24),o(25,"translate"),a()(),n(26,"ng-option",5)(27,"vdr-chip",7),s(28),o(29,"translate"),a()(),n(30,"ng-option",5)(31,"vdr-chip",8),s(32),o(33,"translate"),a()(),n(34,"ng-option",5)(35,"vdr-chip",8),s(36),o(37,"translate"),a()()(),n(38,"ng-select",9),o(39,"async"),b("change",function(){return m.refresh()}),g(40,We,3,2,"ng-template",10),a()()()(),n(41,"vdr-data-table-2",11),o(42,"async"),o(43,"async"),o(44,"async"),o(45,"async"),b("pageChange",function(C){return m.setPageNumber(C)})("itemsPerPageChange",function(C){return m.setItemsPerPage(C)}),n(46,"vdr-dt2-column",12),o(47,"translate"),g(48,Ke,1,1,"ng-template"),a(),n(49,"vdr-dt2-column",13),o(50,"translate"),g(51,Xe,2,3,"ng-template"),a(),n(52,"vdr-dt2-column",14),o(53,"translate"),g(54,Ze,2,2,"ng-template"),a(),n(55,"vdr-dt2-column",15),o(56,"translate"),g(57,tt,1,1,"ng-template"),a(),n(58,"vdr-dt2-column",16),o(59,"translate"),g(60,at,3,3,"ng-template"),a(),n(61,"vdr-dt2-column",17),o(62,"translate"),g(63,ot,2,3,"ng-template"),a(),n(64,"vdr-dt2-column",18),o(65,"translate"),g(66,st,3,3,"ng-template"),a()()()),c&2&&(i(7),l("formControl",m.liveUpdate),i(2),v(r(10,42,"common.live-update")),i(4),l("addTag",!1)("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",m.stateFilter),i(),l("value",""),i(2),v(r(17,44,"system.job-state-all")),i(2),l("value","PENDING"),i(2),v(r(21,46,"system.job-state-pending")),i(2),l("value","RUNNING"),i(2),v(r(25,48,"system.job-state-running")),i(2),l("value","COMPLETED"),i(2),v(r(29,50,"system.job-state-completed")),i(2),l("value","FAILED"),i(2),v(r(33,52,"system.job-state-failed")),i(2),l("value","CANCELLED"),i(2),v(r(37,54,"system.job-state-cancelled")),i(2),l("addTag",!1)("items",r(39,56,m.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",m.queueFilter),i(3),l("items",r(42,58,m.items$))("itemsPerPage",r(43,60,m.itemsPerPage$))("totalItems",r(44,62,m.totalItems$))("currentPage",r(45,64,m.currentPage$)),i(5),l("heading",r(47,66,"common.id")),i(3),l("heading",r(50,68,"common.created-at")),i(3),l("heading",r(53,70,"system.job-queue-name"))("optional",!1),i(3),l("heading",r(56,72,"system.job-data"))("optional",!1),i(3),l("heading",r(59,74,"system.job-state")),i(3),l("heading",r(62,76,"system.job-duration")),i(3),l("heading",r(65,78,"system.job-result")))},dependencies:[P,ge,_e,ve,j,me,de,ue,Ce,be,he,fe,O,M,A,k,je,Ie,Se,Ee,Te,De,J,Le,we,q,H,$,R,mt,N,F,ke,Fe,Ne],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-400)}"],changeDetection:0})}}return e})(),ut=[{path:"jobs",component:dt,data:{breadcrumb:"breadcrumb.job-queue"}},{path:"system-status",component:ct,data:{breadcrumb:"breadcrumb.system-status"}}],jt=(()=>{class e{static{this.\u0275fac=function(c){return new(c||e)}}static{this.\u0275mod=Y({type:e})}static{this.\u0275inj=U({imports:[Je,ce.forChild(ut)]})}}return e})();export{ct as HealthCheckComponent,dt as JobListComponent,mt as JobStateLabelComponent,jt as SystemModule,ut as systemRoutes};
//# sourceMappingURL=chunk-TGXGCHQU.js.map
